<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css" integrity="sha512-uf06llspW44/LZpHzHT6qBOIVODjWtv4MxCricRxkzvopAlSWnTf6hpZTFxuuZcuNE9CBQhqE0Seu1CoRk84nQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js" integrity="sha512-hG/Qw6E14LsVUaQRSgw0RrFA1wl5QPG1a4bCOUgwzkGPIVFsOPUPpbr90DFavEEqFMwFXPVI0NS4MzKsInlKxQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js" integrity="sha512-I6CdJdruzGtvDyvdO4YsiAq+pkWf2efgd1ZUSK2FnM/u2VuRASPC7GowWQrWyjxCZn6CT89s3ddGI+be0Ak9Fg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/matchbrackets.min.js" integrity="sha512-GSYCbN/le5gNmfAWVEjg1tKnOH7ilK6xCLgA7c48IReoIR2g2vldxTM6kZlN6o3VtWIe6fHu/qhwxIt11J8EBA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/selection/active-line.min.js" integrity="sha512-0sDhEPgX5DsfNcL5ty4kP6tR8H2vPkn40GwA0RYTshkbksURAlsRVnG4ECPPBQh7ZYU6S3rGvp5uhlGQUNrcmA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<div data-controller='streamed-script-tag'>
  <%= form_with model: tag, url: tag_builder_update_path(tag), data: { controller: 'loading_form' } do |f| %>
    <label>Paste JS snippet to inject on your page here</label>
    <%= f.text_area :js_script, class: 'code-mirror-textarea hidden', data: { controller: 'code-mirror', code_mirror_target: 'codeMirrorTextarea', dont_wrap_lines: 'true' } %>
    <% if tag.errors.any? %>
      <span class='mt-2 d-block' style='color: red'><%= tag.errors.full_messages.join('. ') %></span>
    <% end %>
    <input type='hidden' name='current_view' value="resource">
    <%= f.hidden_field :load_type, value: tag.load_type %>
    <%= f.hidden_field :script_inject_priority, value: tag.script_inject_priority %>
    <%= f.hidden_field :script_inject_location, value: tag.script_inject_location %>
    <%= f.hidden_field :script_inject_event, value: tag.script_inject_event %>
    <%= f.hidden_field :execute_script_in_web_worker, value: tag.execute_script_in_web_worker %>
    <%= f.hidden_field :is_tagsafe_hosted, value: tag.is_tagsafe_hosted %>
    <div class='mt-2'>
      <%= loading_submit_button type: 'floating', button_class: 'float-end' do %>
        Set load rules <i class='fa-solid fa-arrow-right-long'></i>
      <% end %>
    </div>
  <% end %>
</div>