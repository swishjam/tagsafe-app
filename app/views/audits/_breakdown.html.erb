<%= render 'partials/progress_ring', 
            score: audit.tagsafe_score, 
            change_in_score: audit.audit_to_compare_with.present? ? audit.tagsafe_score - audit.audit_to_compare_with&.tagsafe_score : nil %>

<div class='mt-3'>
  <% audit.audit_components.each do |audit_component| %>
    <div class='mb-2'>
      <span class='fs-6'>
        <%= audit_component.friendly_name %> <span class='fw-bolder'><%= audit_component.formatted_score %> / 100</span>
        <% if audit.audit_to_compare_with %>
          <% change_in_score = audit_component.score - audit_component.audit_component_to_compare_with.score %>
          <% if change_in_score > 0 %>
            <i class="fa-solid fa-arrow-trend-up text-success" data-controller='tooltip' title="Up from <%= audit_component.audit_component_to_compare_with.score %> on <%= audit.audit_to_compare_with.created_at.formatted_short %>"></i>
          <% elsif change_in_score < 0 %>
            <i class="fa-solid fa-arrow-trend-down text-danger" data-controller='tooltip' title="Down from <%= audit_component.audit_component_to_compare_with.score %> on <%= audit.audit_to_compare_with.created_at.formatted_short %>"></i>
          <% end %>
        <% end %>
      </span>
      <div class='audit-component-visual-bar' data-controller='tooltip' title="The <%= audit_component.friendly_name %> audit scored a <%= audit_component.formatted_score %> / 100. <%= audit_component.explanation %>">
        <div class='audit-component-visual-inner-bar <%= audit_component.score >= 90 ? 'good' : audit_component.score >= 80 ? 'warn' : 'bad' %>' style='width: <%= audit_component.score %>%'>
        </div>
        <div class='audit-component-visual-outter-bar' style='width: <%= 100 - audit_component.score %>%'>
        </div>
      </div>
    </div>
  <% end %>
</div>