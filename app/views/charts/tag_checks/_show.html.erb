<%= turbo_frame_tag "tag_#{tag.uid}_uptime_chart" do %>
  <div class='tagsafe-container'>
    <div class='container-fluid'>
      <div class='row'>
        <div class='col-6'>
          <%= render 'charts/time_range_selector', selected_range: time_range, chart_data_endpoint: charts_tag_check_path(tag, aws_regions: selected_tag_check_regions.collect(&:aws_region_name)) %>
        </div>
        <div class='col-6 text-end'>
          <div class="dropdown-container d-inline-block m-3 w-fit ps-3 pe-3">
            <div class='dropdown-display-container' data-controller='dropdown' data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              <span class='display-text'><i class="metric-icon fa-solid fa-earth-americas"></i><%= selected_tag_check_regions.collect(&:location).join(', ') %></span> 
              <span class='dropdown-indicator'><i class="fa-solid fa-chevron-up"></i></span>
            </div>
            <div class="dropdown-menu p-3">
              <%= form_with url: charts_tag_check_path(tag, time_range: time_range), method: :get, html: { class: 'float-end' }, data: { controller: 'submit-form-changes' } do |f| %>
                <% TagCheckRegion.selectable.each do |tag_check_region| %>
                  <div class='form-switch form-check'>
                    <input type='checkbox' name='aws_regions[]' id="uptime-chart-tag-check-region-<%=tag_check_region.id%>" value="<%= tag_check_region.aws_region_name %>" class='form-check-input pointer d-inline' <%= selected_tag_check_regions.index(tag_check_region).present? ? 'checked' : nil %>>
                    <label for='uptime-chart-tag-check-region-<%=tag_check_region.id%>'><%= tag_check_region.location %></label>
                  </div>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
      <div data-controller='streamed-script-tag'>
        <%=
          line_chart chart_data,
            download: true, 
            title: "Tag Uptime",
            ytitle: "Response Time (ms)",
            messages: { empty: "No uptime data to visualize for #{selected_tag_check_regions.collect(&:location)} region(s)." },
            curve: false, 
            legend: "bottom",
            library: {
              rangeSelector: true,
              hAxis: { 
                format: 'MM-DD-YYYY hh:mm' 
              }
            }
        %>
      </div>
    </div>
  </div>
<% end %>