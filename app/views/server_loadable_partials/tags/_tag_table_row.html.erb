<%= turbo_frame_tag "#{domain.uid}_domain_tags_table_row_#{tag.uid}" do %>
  <%= link_to tag_path(tag), class: 'no-decoration', target: '_top' do %>
    <div class='tagsafe-table-row clickable <%= local_assigns[:streamed] ? 'tagsafe-illuminate' : nil %>'>
      <div class='tagsafe-table-data' style='width: 50%'>
        <div class='tag-img-thumbnail-container'>
          <%= image_tag tag.try_image_url, class: 'tag-thumbnail border' %>
        </div>
        <div class='tag-name-container' style="word-break: break-all"><%= tag.try_friendly_name %></div>
      </div>
      <div class='tagsafe-table-data' style='width: 17%'>
        <% if tag.current_version %>
          <%= render 'audits/primary_audit_for_tag_version_pill', tag: tag, tag_version: tag.current_version %>
        <% else %>
          --
        <% end %>
      </div>
      <div class='tagsafe-table-data' style='width: 17%'>
        <% audit = tag.current_version&.audit_to_display %>
        <% if audit %>
          <% if audit.include_functional_tests %>
            <% passed_tests = audit.test_runs_with_tag.passed.count %>
            <% completed_tests = audit.test_runs_with_tag.completed.count %>
            <% if passed_tests == completed_tests %>
              <span class='test-run-icon passed m-1'><i class='far fa-check-circle green-text'></i></span>
            <% else %>
              <span class='test-run-icon failed m-1'><i class='far fa-times-circle red-text'></i></span>
            <% end %>
            <span><%= passed_tests %>/<%= completed_tests %></span>
          <% else %>
            <span>Tests disabled</span>
          <% end %>
        <% end %>
      </div>
      <div class='tagsafe-table-data' style='width: 17%'><%= tag.content_changed_at&.formatted_short || 'No releases' %></div>
      <div class='tagsafe-table-data text-end' style='width: 5%'>
        <span class='link-indicator hover-enlarge'><i class="fas fa-angle-double-right"></i></span>
      </div>
    </div>
  <% end %>
<% end %>