<%= render_as_modal title: 'Add Payment Method' do %>
  <% if local_assigns[:success_message] %>
    <div class='tagsafe-modal-body'>
      <h2 class='tagsafe-font'><%= success_message %></h2>
    </div>
  <% else %>
    <div data-controller='stripe-payment-element' data-pk="<%= ENV['STRIPE_PUBLIC_KEY'] %>" data-client-secret="<%= client_secret %>" data-subscription-option="<%= subscription_option_to_apply_on_success&.id %>">
      <form id='payment-method-form' data-turbo='false' data-stripe-payment-element-target='paymentForm' data-controller='loading_form'>
        <div class='tagsafe-modal-body'>
          <% if local_assigns[:include_back_button] %>
            <div class='text-start mb-3'>
              <%= modal_link edit_domain_subscription_option_path(current_domain) do %>
                <i class="fa-solid fa-arrow-left"></i> Back to Plan Selection
              <% end %>
            </div>
          <% end %>
          <% if subscription_option_to_apply_on_success %>
            <h2 class='tagsafe-font'><%= subscription_option_to_apply_on_success.name %></h2>
          <% end %>
          <div data-stripe-payment-element-target='awaitingElementsIcon'>
            <%= display_loading_icon %>
          </div>
          <div data-stripe-payment-element-target='paymentElementMount'>
          </div>
        </div>
        <div class='mb-1' data-stripe-payment-element-target='paymentError' style='color: red;'>
        </div>
        <div class='tagsafe-modal-divider'></div>
        <div class='tagsafe-modal-footer text-end'>
          <%= submit_loading_button 'Add payment method for billing' %>
        </div>
      </form>
    </div>
  <% end %>
<% end %>