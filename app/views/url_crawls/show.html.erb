<div class='page-title-container'>
  <div class='container-fluid'>
    <div class='row'>
      <div class='col-8'>
        <h1 class="page-title with-sub-title">Tag Sync</h1>
        <h2 class="page-sub-title"><%= @url_crawl.enqueued_at.formatted_short %> syncing of <%= current_domain.url %> third party tags.</h2>
      </div>
      <div class='col-4 page-title-cta-container'>
        <%= form_with url: url_crawls_path, method: :POST do |f| %>
          <button type='submit' class='page-title-cta-btn floating-btn tagsafe-purple-bg' data-controller='tooltip' data-bs-toggle='tooltip' title='Sync third party tags from <%= current_domain.url %>. Tagsafe automatically syncs tags every hour.'>
            <i class="fa-solid fa-arrows-rotate"></i> Sync tags
          </button>
        <% end %>
      </div>
    </div>
  </div>
  <%= render 'settings/settings_nav' %>
</div>

<div class="tagsafe-container text-center">
  <div class='col-12'>
    <% if @url_crawl.failed? %>
      <h4><%= @url_crawl.error_message %></h4>
    <% else %>
      <h4>Tags URLs returned:</h4>
      <table class="table table-hover col-12 text-start" style="table-layout: fixed">
        <thead>
          <tr>
            <th scope="col" style="width: 100%">Tag returned</th>
          </tr>
        </thead>
        <tbody>
          <% @url_crawl.retrieved_urls.each do |retrieved_url| %>
            <tr><td style='word-break: break-word;'><%= retrieved_url.url %></td></tr>
          <% end %>
        </tbody>
      </table>
      <h4>Tags created:</h4>
      <table class="table table-hover col-12 text-start" style="table-layout: fixed">
        <thead>
          <tr>
            <th scope="col" style="width: 80%">Tag created</th>
            <th scope="col" style="width: 20%"></th>
          </tr>
        </thead>
        <tbody>
          <% @url_crawl.found_tags.each do |tag| %>
            <tr>
              <td style='word-break: break-word;'><%= tag.try_friendly_name %> (<%= tag.url_based_on_preferences %>)</td>
              <td><%= link_to 'View Tag Details', tag_path(tag) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  </div>
</div>