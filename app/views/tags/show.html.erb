<%= turbo_stream_from "tag_#{@tag.uid}_details_view_stream" %>

<div class='page-title-container'>
  <div class='container-fluid'>
    <div class='row'>
      <div class='col-8'>
        <h1 class="page-title with-sub-title">Tag Details</h1>
        <h2 class='page-sub-title'><%= @tag.try_friendly_name %></h2>
      </div>
      <div class='col-4 page-title-cta-container'>
        <%= modal_link new_tag_audit_path(@tag), text: 'Run Audit', klass: 'page-title-cta-btn floating-btn tagsafe-purple-bg' %>
        <%= link_to edit_tag_path(@tag), class: 'page-title-cta-btn floating-btn tagsafe-purple-bg ms-3', data: { controller: 'tooltip', bs_toggle: 'tooltip', title: 'Edit tag settings'} do %>
          <i class="fa-solid fa-gear"></i>
        <% end %>
      </div>
    </div>
  </div>
  <%= render 'partials/page_navigation_items', navigation_items: [
    { text: 'Audit Details', url: tag_path(@tag) },
    { text: 'Tag Uptime', url: uptime_tag_path(@tag) }
  ] %>
</div>

<%= render 'tags/current_stats', tag: @tag %>

<div class="tagsafe-container">
  <% if @tag.removed_from_site? %>
    <div class="row">
      <div class="col-12">
        <div class="alert alert-danger col-10 offset-1 mt-3 text-center" role="alert">
          <%= HtmlHelper.WARNING_ICON %> Tag was removed from <%= current_domain.url %> at <%= @tag.removed_from_site_at.formatted_long %></h6>
        </div>
      </div>
    </div>
  <% end %>
  <%= turbo_frame_tag "#{@tag.uid}_tag_chart", src: charts_tag_path(@tag) do %>
    <div class='text-center'>
      <%= display_loading_spinner %>
    </div>
  <% end %>
</div>

<div class='tagsafe-container p-0'>
  <%= turbo_frame_tag "tag_#{@tag.uid}_audits_table", src: audits_tag_path(@tag) do %>
    <div class='text-center p-5'>
      <%= display_loading_spinner %>
    </div>
  <% end %>
</div>