<%= turbo_frame_tag "tag_#{tag.uid}_uptime_chart" do %>
  <div class='tagsafe-container'>
    <div data-controller='chart' data-fetch-url="<%= tag_uptime_chart_path(tag) %>">
      <div class='container'>
        <div class='row'>
          <div class='col-6'>
            <div class='timeframe-selector-container'>
              <input type="text" name="datetimes" class='tagsafe-dotted-selector' data-chart-target='datepicker' data-start="<%= start_time %>" data-end="<%= end_time %>" />
            </div>
          </div>
          <div class='col-6'>
            <div class='dropdown-container float-end'>
              <div class='dropdown-display-container' data-controller='dropdown' data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class='display-text'><%= selected_tag_check_regions.collect(&:location).join(', ') %></span> 
                <span class='dropdown-indicator'><i class="fa-solid fa-chevron-up"></i></span>
              </div>
              <div class="dropdown-menu p-3">
                <%= form_with url: tag_uptime_chart_path(tag, start_time: start_time, end_time: end_time), method: :get, html: { class: 'float-end' }, data: { controller: 'submit-form-changes' } do |f| %>
                  <% TagCheckRegion.selectable.each do |tag_check_region| %>
                    <div class='form-switch form-check'>
                      <input type='checkbox' name='aws_region_names[]' id="uptime-chart-tag-check-region-<%=tag_check_region.id%>" value="<%= tag_check_region.aws_region_name %>" class='form-check-input pointer d-inline' <%= selected_tag_check_regions.index(tag_check_region).present? ? 'checked' : nil %>>
                      <label for='uptime-chart-tag-check-region-<%=tag_check_region.id%>'><%= tag_check_region.location %> <%= !tag.tag_check_regions.include?(tag_check_region) ? '(disabled)' : nil %></label>
                    </div>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div data-controller='streamed-script-tag'>
        <%=
          line_chart chart_data,
            download: true, 
            title: "Tag Uptime",
            ytitle: "Response Time (ms)",
            messages: { empty: "No uptime data to visualize for the selected region." },
            curve: false, 
            legend: "bottom",
            library: {
              rangeSelector: true,
              hAxis: { 
                format: 'MM-DD-YYYY hh:mm' 
              }
            }
        %>
      </div>
    </div>
  </div>
<% end %>