<% content_for :head do %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css" integrity="sha512-uf06llspW44/LZpHzHT6qBOIVODjWtv4MxCricRxkzvopAlSWnTf6hpZTFxuuZcuNE9CBQhqE0Seu1CoRk84nQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js" integrity="sha512-hG/Qw6E14LsVUaQRSgw0RrFA1wl5QPG1a4bCOUgwzkGPIVFsOPUPpbr90DFavEEqFMwFXPVI0NS4MzKsInlKxQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/javascript/javascript.min.js" integrity="sha512-I6CdJdruzGtvDyvdO4YsiAq+pkWf2efgd1ZUSK2FnM/u2VuRASPC7GowWQrWyjxCZn6CT89s3ddGI+be0Ak9Fg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/matchbrackets.min.js" integrity="sha512-GSYCbN/le5gNmfAWVEjg1tKnOH7ilK6xCLgA7c48IReoIR2g2vldxTM6kZlN6o3VtWIe6fHu/qhwxIt11J8EBA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/selection/active-line.min.js" integrity="sha512-0sDhEPgX5DsfNcL5ty4kP6tR8H2vPkn40GwA0RYTshkbksURAlsRVnG4ECPPBQh7ZYU6S3rGvp5uhlGQUNrcmA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<% end %>

<%= form_with model: tag, url: tags_path(inject_method: 'script'), data: { controller: 'loading_form' } do |f| %>
  <label>Paste JS snippet to inject on your page here</label>
  <%= f.text_area :js_script, class: 'code-mirror-textarea hidden', data: { controller: 'code-mirror', code_mirror_target: 'codeMirrorTextarea', dont_wrap_lines: 'true' } %>
  <div class='form-floating mt-2'>
    <select class='form-select' name='tag[inject_script_at_event]'>
      <option value='immediate' selected>Immediately</option>
      <option value='load'>DOM load</option>
    </select>
    <label>Inject script at (timing)</label>
  </div>
  <div class='form-floating mt-2'>
    <select class='form-select' name='tag[script_inject_location]'>
      <option value='head' selected>Document Head</option>
      <option value='body'>Before closing body tag</option>
    </select>
    <label>Inject script at (location)</label>
  </div>
  <div class='form-check form-switch mt-2'>
    <%= f.check_box :is_tagsafe_hosted, class: 'form-check-input pointer' %>
    <label for='tag_is_tagsafe_hosted' class='pointer'>Tagsafe-hosted?</label>
  </div>
  <% if tag.errors.any? %>
    <span class='mt-2 d-block' style='color: red'><%= tag.errors.full_messages.join('. ') %></span>
  <% end %>
  <div class='mt-2'>
    <%= loading_submit_button 'Add Tag', type: 'floating', button_class: 'float-end' %>
  </div>
<% end %>