<%= turbo_frame_tag "#{tag.uid}_settings" do %>
  <div class='col-10 offset-1 text-start'>
    <% if local_assigns[:success_message] %>
      <div class='alert alert-success mt-2 mb-0'>
        <h5 class='d-flex align-items-center mb-0'><span class='me-2'><%= HtmlHelper.PASSED_ICON(color: 'green') %></span><%= success_message %></h5>
      </div>
    <% end %>
    <% if local_assigns[:error_message] %>
      <div class='alert alert-danger mt-2 mb-0'>
        <h5 class='d-flex align-items-center mb-0'><span class='me-2'><%= HtmlHelper.WARNING_ICON(color: 'red') %></span><%= error_message %></h5>
      </div>
    <% end %>
    <%= form_with model: tag, data: { controller: 'loading_form' } do |f| %>
      <div class='form-floating mt-5 col-12'>
        <div class='row'>
          <div class='col-8'>
            <span class='form-label fs-5 mb-0 fw-bolder d-block'>Release monitoring interval</span>
            <span class='form-label fs-6 d-block'>How often should Tagsafe check <%= tag.url_based_on_preferences %> for a new release?</span>
          </div>
          <div class='col-4 text-end'>
            <select name='tag[release_monitoring_interval_in_minutes]' 
                    id='release-monitoring-interval' 
                    class='form-select w-fit' 
                    <%= !tag.is_tagsafe_hostable ? 'disabled' : nil %>
                    style='width: fit-content'
                    required>
              <% Tag::SUPPORTED_RELEASE_MONITORING_INTERVALS.each do |interval| %>
                <option value='<%= interval %>' <%= interval == tag.release_monitoring_interval_in_minutes ? 'selected' : nil %>>
                  <%= Util.integer_to_interval_in_words(interval).capitalize %>
                </option>
              <% end %>
            </select>
          </div>
        </div>
      </div>

      <div class='form-floating mt-5 col-12'>
        <div class='row'>
          <div class='col-8'>
            <span class='form-label fs-5 mb-0 fw-bolder d-block'>Tag load strategy</span>
            <span class='form-label fs-6 d-block'>Override the default load strategy on the tag's `script` element.</span>
          </div>
          <div class='col-4 text-end'>
            <select name='tag[configured_load_type]' 
                    id='release-monitoring-interval' 
                    class='form-select w-fit' 
                    style='width: fit-content'>
              <option value='default' <%= tag.configured_load_type == 'default' ? 'selected' : nil %>>Tag's default rule</option>
              <option value='defer' <%= tag.configured_load_type == 'defer' ? 'selected' : nil %>>Defer</option>
              <option value='async' <%= tag.configured_load_type == 'async' ? 'selected' : nil %>>Async</option>
              <option value='synchronous' <%= tag.configured_load_type == 'synchronous' ? 'selected' : nil %>>Synchronous</option>
            </select>
          </div>
        </div>
      </div>

      <div class="form-check form-switch mt-5 ps-0 pb-5 col-12">
        <div class='row'>
          <div class='col-8'>
            <span class='form-label fs-5 mb-0 fw-bolder d-block'>Tagsafe-hosted and optimized</span>
            <span class='form-label fs-6 d-block'>Disable to use the tag's default CDN instead of Tagsafe's optimized CDN.</span>
          </div>
          <div class='col-4 text-end'>
            <input type='hidden' name='tag[is_tagsafe_hosted]' value='0'>
            <input type='checkbox' 
                    name='tag[is_tagsafe_hosted]'
                    class='form-check-input ms-3 pointer' 
                    role='switch' 
                    style='scale: 2' 
                    value='1'
                    <%= tag.is_tagsafe_hosted ? 'checked=checked' : nil%>
                    <%= !tag.is_tagsafe_hostable ? 'disabled' : nil %>>
          </div>
        </div>
      </div>
      <div class='text-end'>
        <%= loading_submit_button 'Update tag settings', type: 'floating' %>
      </div>
    <% end %>
  </div>
<% end %>
