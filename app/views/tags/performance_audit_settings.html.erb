<h5 class="page-title" style="margin-bottom: 0;">Tag Settings</h5>
<h6 class="page-sub-title"><%= @tag.try_friendly_name %></h6>

<%= render partial: 'edit_tag_nav', locals: { tag: @tag } %>

<div class="text-center tag-safe-container">
  <div class="col-8 offset-2">
    <h5>Tag's Performance Audit settings</h5>
    <%= form_for @tag do |f| %>
      <%= f.fields_for :tag_preferences_attributes, @tag.tag_preferences do |ff| %>
        <div class="form-group">
          <%= f.label :url_to_audit %>
          <%= f.text_field :url_to_audit, value: @tag.tag_preferences.url_to_audit, class: "form-control form-control-lg" %>
        </div>
        <div class="form-group">
          <%= f.label :throttle_minute_threshold %>
          <%= f.text_field :throttle_minute_threshold, value: @tag.tag_preferences.throttle_minute_threshold, placeholder: 'Change audit throttle minutes' %>
        </div>
        <div class="form-group">
          <%= f.submit "Update Performance Audit Settings", class: 'btn btn-outline-primary' %>
        </div>
      <% end %>
    <% end %>
    <h6>
      Third party tags to not block during performance audits:
      <span data-toggle="tooltip"
              data-placement="top"
              title="By default, TagSafe blocks all other third party tags from running during performance audits. Define any tags you do not want to block during <%=@tag.try_friendly_name%> performance audits. ie: if a tag manager adds this tag to the page, you must add the third party tag to allowed tag list.">
              <i class="far fa-question-circle"></i>
      </span>
    </h6>
    <%= form_for TagAllowedPerformanceAuditThirdPartyUrl.new, url: tag_tag_allowed_performance_audit_third_party_urls_path(@tag) do |f| %>
      <%= f.text_field :url_pattern, placeholder: 'URL Pattern' %>
      <%= f.submit 'Add Allowed Tag', class: 'btn btn-outline-primary' %>
    <% end %>
    <ul class="list-group">
      <% @tag.tag_allowed_performance_audit_third_party_urls.each do |allowed| %>
        <li class="list-group-item">
          <span class="allowed-script-subscriber-name"><%= allowed.url_pattern %></span>
          <span class="delete-allowed-script-subscriber" style="float: right;"><%= button_to 'X', tag_tag_allowed_performance_audit_third_party_url_path(@tag, allowed), method: :delete %></span>
        </li>
      <% end %>
    </ul>
  </div>
</div>