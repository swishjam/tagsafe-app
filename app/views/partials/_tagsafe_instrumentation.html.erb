<script>
  (function() {
    try {
      window.tagsafe = window.tagsafe || {};
      function rewriteScriptUrl(url) {
        return ['https://cdn.tagsafe.io/script/', url.replace(/\//g, '_').replace(/\:/g, '_').replace(/\./g, '_')].join('');
      }

      var ogAppendChild = Node.prototype.appendChild;
      Node.prototype.appendChild = function(el) {
        if(el.nodeName === 'SCRIPT' && el.src) {
          console.log('Overriding '+el.src);
          el.setAttribute('data-og-src', el.src);
          el.setAttribute('src', rewriteScriptUrl(el.src));
          el.setAttribute('data-tagsafe-interceptted', true)
        };
        ogAppendChild.apply(this, arguments);
      };

      var ogInsertBefore = Node.prototype.insertBefore;
      Node.prototype.insertBefore = function(newNode, referenceNode) {
        if(newNode.nodeName === 'SCRIPT' && newNode.src) {
          console.log('Overriding '+newNode.src);
          newNode.setAttribute('data-og-src', newNode.src);
          newNode.setAttribute('src', rewriteScriptUrl(newNode.src));
          newNode.setAttribute('data-tagsafe-interceptted', true)
        };
        ogInsertBefore.apply(this, arguments);
      };

      var ogPrepend = Node.prototype.prepend;
      Node.prototype.prepend = function() {
        ogPrepend.apply(this, arguments);
      };

      window.tagsafe.appendChild = Node.prototype.appendChild;
      window.tagsafe.insertBefore = Node.prototype.insertBefore;
      console.log("Tagsafe injected script tag catcher installed succesfully.");
    } catch(e) {
      console.error("Tagsafe error in catching injected script tags.");
    }
  })()
</script>