<h5 class="text-center">Notification Preferences</h5>

<% if current_domain.nil? %>
  <h5>You have not defined your domain(s) to monitor.</h5>
<% else %>
  <table class="table table-hover col-12" style="table-layout: fixed">
    <thead>
      <tr>
        <th scope="col" class="col-8" style='width: 40%'>Tag</th>
        <th scope="col" class="col-2" style='width: 15%'>On tag changes.</th>
        <th scope="col" class="col-2" style='width: 15%'>On each completed audit.</th>
        <th scope="col" class="col-2" style='width: 15%'>When performance thresholds are exceeded.</th>
        <th scope="col" class="col-2" style='width: 15%'>On failed tests.</th>
      </tr>
    </thead>
    <tbody>
      <% @script_subscriptions.each do |script_subscription| %>
        <tr>
          <td scope="row" style='overflow: hidden; text-overflow: ellipsis; white-space: nowrap;'><%= script_subscription.try_friendly_name %></td>
          <% 
            [{
            toggle_endpoint_suffix: "toggle_script_change_notification",
            klass: ScriptChangeNotificationSubscriber
          },
          {
            toggle_endpoint_suffix: "toggle_audit_complete_notification",
            klass: AuditCompleteNotificationSubscriber
          },
          {
            toggle_endpoint_suffix: "toggle_lighthouse_audit_exceeded_threshold_notification",
            klass: LighthouseAuditExceededThresholdNotificationSubscriber
          },
          {
            toggle_endpoint_suffix: "toggle_test_failed_notification",
            klass: FailedTestNotificationSubscriber
          }].each do |preference_obj|
          %>
            <td>
              <div class="custom-control custom-switch" style='cursor: pointer'>
                <input style="cursor: pointer" type="checkbox" class="custom-control-input" id="<%=preference_obj[:toggle_endpoint_suffix]%>-<%=script_subscription.id%>" <%= current_user.subscribed_to_notification?(preference_obj[:klass], script_subscription) ? 'checked' : nil %> onclick="var xhr = new XMLHttpRequest();xhr.open('POST', '/api/notification_preferences/<%= script_subscription.id %>/<%= preference_obj[:toggle_endpoint_suffix] %>', true);xhr.send();">
                <label class="custom-control-label" for="<%=preference_obj[:toggle_endpoint_suffix]%>-<%=script_subscription.id%>" style='cursor: pointer;'>Subscribed</label>
              </div>
            </td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>